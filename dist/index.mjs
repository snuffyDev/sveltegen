#!/usr/bin/env node
import{readdirSync as lt,writeFileSync as mt}from"fs";import{homedir as ut}from"os";import{join as dt,resolve as O}from"path";import gt from"readline";var F=(...t)=>process.stdout.hasColors()?"\x1B[92m"+t[0]+"\x1B[39m":t[0];var J=(...t)=>process.stdout.hasColors()?"\x1B[104m"+t[0]+"\x1B[49m":t[0];var U=(...t)=>process.stdout.hasColors()?"\x1B[97m"+t[0]+"\x1B[39m":t[0];var x=(...t)=>process.stdout.hasColors()?"\x1B[1m"+t[0]+"\x1B[22m":t[0],m=(...t)=>process.stdout.hasColors()?"\x1B[2m"+t[0]+"\x1B[22m":t[0];var W=(...t)=>process.stdout.hasColors()?"\x1B[4m"+t[0]+"\x1B[24m":t[0],H=(...t)=>process.stdout.hasColors()?"\x1B[7m"+t[0]+"\x1B[27m":t[0];async function V(t){let o=process.stdout,n=process.stdin,s=gt.createInterface({input:n,output:o,completer:l=>{let d=l.lastIndexOf("/"),G=l.indexOf("/")?l.substring(0,d+1):"",ct=l.substr(d+1),at=O(G),D=lt(at),y=D.filter(pt=>pt.indexOf(ct)===0),A=[];return y.length===1&&A.push(G+y[0]+"/"),A.length?[A,l]:[y.length?y:D,l]}});s.write(`
`+(t?m("[GLOBAL] "):m("[LOCAL] "))+`sveltegen Configuration -- Leave path blank if unneeded.

`);function e(l){return new Promise((d,it)=>{s.question(l,d)})}let a=l=>typeof l>"u"?null:O(l),c={},i=await e("Path to actions directory?  "),r=await e("Path to components directory?  "),p=await e("Path to routes directory?  ");c.actions=a(i),c.components=a(r),c.routes=a(p);let S=JSON.stringify(c);s.close(),mt(O(t?dt(ut(),".sveltegen.json"):"./.sveltegen.json"),S,{encoding:"utf-8"})}var C=(t,o,n)=>`${H(F("Finished"))+` generating ${n} \`${t}\`!`}

Output Path: ${W(o)}`,ht=/[\t\s\n]*\/{2,3}@?.*|import\s(type\s)?\{.*}\s.*;|\slang="ts"|(?:\:\s.[a-zA-Z\.<>]+)/gm;function _(t){return t.replace(ht,"")}var Y=t=>t.replace(/[\t\s\n]*?\/{2,3}?@?.+$/gm,""),u={log(...t){if(!!t.length)for(let o=-1;++o<t.length;)console.log(t[o])},err(...t){if(!!t.length)for(let o=-1;++o<t.length;)console.error(t[o])},warn(...t){if(!!t.length)for(let o=-1;++o<t.length;)console.warn(t[o])},info(...t){if(!!t.length)for(let o=-1;++o<t.length;)console.info(t[o])}};var ft=/^-[a-z]$/i,bt=/^--[a-z]{2,}/i;function yt(t){return ft.test(t)}function xt(t){return bt.test(t)}function E(t){return t.replace(/([[\]<>]+)/g,"")}function q(t){let o={name:"",longNotation:"",shortNotation:"",type:0,allNames:[],allNotations:[],rawArgs:[],args:[],longName:"",shortName:""},n=t.split(/[\s\t,]+/).reduce((s,e)=>(xt(e)&&(s.longNotation=e,s.longName=E(e.slice(2)),s.allNames.push(s.longName),s.allNotations.push(e)),yt(e)&&(s.shortNotation=e,s.shortName=e.slice(1),s.allNames.push(s.shortName),s.allNotations.push(e)),e[0]==="["?(s.type=0,s.rawArgs.push(E(e))):e[0]==="<"?(s.type=1,s.rawArgs.push(E(e))):s.type=2,s),o);return n.name=n.longName||n.shortName,Object.assign({},{...n})}var g=class{constructor(o,n,s){this.name=o;this.args=n;this.opts=s;this._options={},this.option("-?, --help","Gets help for this option")}_value;_flags=[];_description="";_action;_example="";_options={};_helpText="";_examples=[];get flags(){return this._flags}get value(){return this._value}get description(){return this._description}get options(){return this._options}option(o,n,s){let e=q(o);return this._options[e.name]={...e,description:n,defaultValue:s},this._helpText+=`${o.padEnd(48," ")} ${n||""}
 `,this}action(o){return this._action=o,this}describe(o){if(typeof o!="string")throw new TypeError("Provided description is not a valid string!");return this._description=o,this}example(o,n=""){if(!o||typeof o!="string")throw new Error(o?"Argument `snippet` must be a valid string.":"Argument `snippet` not found. `snippet` must be a valid string.");return this._example+="  "+o.padEnd(48," ")+n+`
`,this}getHelp(){let o=`${this.name+" "+this.args[0]} [options]

`,n=this._helpText,s=this._example;return{header:o,options:n,examples:s}}run(o){let n={},s=o[0],e;for(;e=o.shift();)for(let a in this._options){let c=this._options[a],i=e===c.longNotation,r=e===c.shortNotation;(i||r)&&(n[a]=!0)}if(n.help){let a=`${this.name+" "+this.args[0]} [options]

`,c=this._helpText;return{header:a,options:c,examples:this._example}}try{this._action(s,n,{})}catch(a){u.err(a)}}};var v=class{constructor(o,n){this.name=o;this.version=n;this._commands.help=new g("help",["<cmd>"],{alias:"h"}).action((s,e)=>{if(!s)return this.help();let c=Object.assign({},this._commands,this._aliases)[s].getHelp(),i=`
${x(m(this.name+" "+(this.version?`v${this.version}`:" ")))}

`;console.log(i+` ${"Usage: "+this.name} `+c.header,m(`Options: 
`),c.options+`

`)}),this._commands.help.describe("Provides help for a specific command")}_commands={};_aliases={};_defaultCmd;help(){let o=`
${x(m(this.name+" "+(this.version?`v${this.version}`:" ")))}

`,n=`s${this.name} `,s="",a=Object.keys(this._commands).forEach(r=>this._commands[r]&&(s+=`	${this._commands[r]?.name?.padEnd(16," ")}${this._commands[r]?.args[0]?.padEnd(8," ")}${this._commands[r]?.description}
`)),c=` ${m`Commands:`}
`,i=`
 Need help? To get help for a command run:
	${this.name} [command] --help
`;process.stdout.write(o+c+s+i+`
`)}command(o,n=[],s){return this._commands[o]=new g(o,n,s),s?.alias&&(this._aliases[s.alias]=this._commands[o]),s?.isDefault&&(this._defaultCmd=this._commands[o]),this._commands[o]}parse(o){let n=Object.assign({},this._commands,this._aliases),s=new Set(Object.keys(n)),e=o.sort((p,S)=>{let l=p.startsWith("-"),d=S.startsWith("-");if(l<d)return-1;if(d<l)return 1;if(l===d)return 0}),a=e.findIndex(p=>s.has(p)),c=o[a],i=n[c];if(a<0){this.help();return}let r=i.run(e.slice(1));if(r){let p=`
${x(m(this.name+" "+(this.version?`v${this.version}`:" ")))}

`;console.log(p+` ${"Usage: "+this.name} `+r.header,m(`Options: 
`),r.options+`
`+(r.examples?m(`
Examples: 
`)+r.examples:"")+`
`)}}usage(){}};import{readdirSync as P,readFileSync as k,writeFileSync as L}from"fs";import{join as N,resolve as B,sep as tt}from"path";import{copyFileSync as Ct,existsSync as K,mkdirSync as _t,readdirSync as vt,readFileSync as wt,rmdirSync as Tt,rmSync as Nt,statSync as St}from"fs";import{dirname as At,join as z,resolve as Z}from"path";function h(t){try{_t(t,{recursive:!0})}catch(o){if(o.code==="EEXIST")return;throw o}}function X(t){(Nt||Tt)(t,{recursive:!0,force:!0})}function Ot(t){return t}function $(t,o,n=Ot){if(!K(t))return;St(t).isDirectory()?vt(t).forEach(e=>{$(z(t,e),z(o,n(e)))}):(h(At(o)),Ct(t,o))}var w=t=>Z("./templates/"+t),Q=Z("./.sveltegen.json"),f=()=>K(Q),T=()=>{if(f())return JSON.parse(wt(Q))};function R(t,o){let n=t.length,s=-1;for(;++s<n;)o(t[s],s,t);s=null}var j=(t,o,n,s)=>$(`${t}`,o,e=>(e=e.replaceAll("_name",n),s.typescript||(e=e.replace(".ts",".js")),s?.scss||(e=e.replace(".scss",".css")),e));function ot(t,o={scss:!1,typescript:!1}){if(!f())return;let s=t.split(/\\\\|\//gm).pop(),e=B(T().components+tt+t);if(e===null)return u.err('`components` directory is not defined. Please run "sveltegen config" to specify a path.');h(e);let a=w("components");j(a,e,s,o),R(P(e),c=>{let i=N(e,c),r=k(i,{encoding:"utf-8"});o.typescript||(r=_(r)),o.scss||(r=r.replace(/scss/gm,"css")),r=r.replaceAll("_name",t),L(i,r,{encoding:"utf-8"})}),u.log(C(s,e,"component"))}function st(t,o={endpoint:!1,page:!1,scss:!1,typescript:!1}){if(!f())return;let s=t.split(/\\\\|\//gm).pop(),e=B(T().routes+tt+t);if(e===null)return u.err('`routes` directory is not defined. Please run "sveltegen config" to specify a path.');h(e);let a=w("routes");j(a,e,s,o),P(e).forEach(c=>{let i=N(e,c),r=k(i,{encoding:"utf-8"});if(i.includes(".json")&&!o.endpoint||i.endsWith(".svelte")&&!o.page){X(i);return}o.typescript?o.typescript&&(r=Y(r)):(r=_(r),r=r.replace(/\t\n+|(?<=>)|\n$/gm,"")),o.scss||(i.replace(".scss",".css"),r=r.replace(/scss/gm,"css")),r=r.replaceAll("_name",t),L(i,r,{encoding:"utf-8"})}),u.log(C(s,e,"component"))}function et(t,o){if(!f())return;let s=t.split(/\\\\|\//gm).pop(),e=B(T().actions);if(e===null)return u.err('`actions` directory is not defined. Please run "sveltegen config" to specify a path.');h(e);let a=w("actions");j(a,e,s,o);let c=N(e,s);R(P(e),i=>{let r=N(e,i),p=k(r,{encoding:"utf-8"});o.typescript||(p=_(p)),p=p.replaceAll("_name",t),L(r,p,{encoding:"utf-8"})}),u.log(C(s,c,"action"))}import{readFileSync as Pt}from"fs";import{get as Et}from"https";async function I(t,o,n={method:"GET"}){let s=new URL(t);return new Promise((e,a)=>{let c="";Et(s,i=>{let r=i.statusCode;r>=400?a({code:r,message:i.statusMessage}):r>=300?I(i.headers.location).then(e,a):(i.setEncoding("utf-8"),i.on("data",p=>{c+=p}).on("end",()=>{e(JSON.parse(c))}))})})}var $t=(t,o)=>m`> `+`Installed: ${t}
`+m`> `+`Latest: ${o}
`,Rt=(t,o,n)=>m`\n> `+U(J`UPDATE AVAILABLE!`+` Run \`npm i -g ${t}@latest\` to install ${t} ${n}
`+o);async function nt(t,o){let s=(await I(`https://registry.npmjs.org/${t}/latest`,"json",{method:"GET"}))?.version||null;if(s===null)throw new Error("An error has occured when checking for the latest package version.");let e=()=>console.log(Rt(t,$t(o,s),s));o<s&&(process.on("SIGINT",()=>e()),process.on("exit",()=>e()),process.on("uncaughtException",()=>e()))}var kt=Pt(new URL("../package.json",import.meta.url),{encoding:"utf-8"}),{version:rt,name:Lt}=JSON.parse(kt);nt(Lt,rt);var b=new v("sveltegen",rt);b.command("component",["<name>"],{alias:"c"}).describe("Creates a new component").option("-s, --scss","Creates a new component using SCSS for styles").option("-t, --typescript","Creates a new component using Typescript").example("sveltegen c Button -t","creates a `Button` component with TS/CSS").example("sveltegen component Article","creates an `Article` component with JS/CSS").action(ot);b.command("action",["<name>"],{alias:"a"}).describe("Creates a new action").option("-t, --typescript","Creates a new component using Typescript").action(et);b.command("route",["<name>"],{alias:"r"}).describe("Creates a new route").option("-t, --typescript","Creates a new route using TypeScript").option("-p, --page","Creates a page-only route").option("-e, --endpoint","Creates an endpoint-only route").option("-s, --scss","Adds SCSS for styles").action(st);b.command("config",["<action>"],{isDefault:!0}).action((t,o)=>{V(!!o?.global)}).option("-g, --global","Configures Sveltegen globally").example;b.parse(process.argv.slice(2));
